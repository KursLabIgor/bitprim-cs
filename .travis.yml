language: csharp  
sudo: required  
dist: trusty

configuration:
- Release

env:  
  - CLI_VERSION=latest
addons:  
  apt:
    packages:
    - gettext
    - libcurl4-openssl-dev
    - libicu-dev
    - libssl-dev
    - libunwind8
    - zlib1g
mono:  
  - 4.2.3

linux: &linux
   os: linux
   sudo: required
   language: python
   python: "3.6"

osx: &osx
   os: osx
   language: generic

matrix:
   include:
      - <<: *linux
        compiler: gcc
        env: C_COMPILER=gcc-6 CXX_COMPILER=g++-6

      - <<: *osx
        osx_image: xcode8.3

before_install:
  - |
    if test "$TRAVIS_OS_NAME" == "osx"; then
      ln -s /usr/local/opt/openssl/lib/libcrypto.1.0.0.dylib /usr/local/lib/;
      ln -s /usr/local/opt/openssl/lib/libssl.1.0.0.dylib /usr/local/lib/;
    fi
  - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
  - sudo apt-get update -qq

install:
  - |
    if [[ "${UPDATE_DOCS}" != "true" ]]; then
      if [[ "${TRAVIS_OS_NAME}" != "linux" ]]; then
        brew update || brew update
        brew outdated pyenv || brew upgrade pyenv
        brew install pyenv-virtualenv
        brew install cmake || true
        if which pyenv > /dev/null; then
            eval "$(pyenv init -)"
            eval "$(pyenv virtualenv-init -)" 
        fi
        if [[ "$TRAVIS_PYTHON_VERSION" == "2.7" ]]; then
          pyenv install 2.7.10
          pyenv virtualenv 2.7.10 conan
        else
          pyenv install 3.6.1
          pyenv virtualenv 3.6.1 conan
        fi
        pyenv rehash
        pyenv activate conan
      fi
    fi
  - sudo -H pip install conan_package_tools --upgrade
  - sudo -H pip install conan --upgrade
  - conan user
  - conan remote add bitprim_temp https://api.bintray.com/conan/bitprim/bitprim
  - curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
  - sudo mv microsoft.gpg /etc/apt/trusted.gpg.d/microsoft.gpg
  - sudo sh -c 'echo "deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-ubuntu-trusty-prod trusty main" > /etc/apt/sources.list.d/dotnetdev.list'
  - sudo apt-get update -y
  - sudo apt-get install dotnet-sdk-2.0.2 -y
  - sudo apt-get install -qq g++-6
  - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-6 90
  - sudo ldconfig
script:
  - chmod +x build.sh  
  - ./build.sh
